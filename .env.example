# Z-Image Monorepo (shared .env example)
#
# 推荐：把本文件复制为仓库根目录 `.env`，然后通过 scripts/dev_*.sh 启动服务。
# - `docker compose` 会自动读取仓库根目录 `.env`（用于 MinIO 等容器配置）
# - Python 应用（api/worker）会在启动时优先读取仓库根目录 `.env`
#
# 注意：`.env` 禁止提交 Git；请只提交 `.env.example`

# ---- 基础环境 ----
ENVIRONMENT=dev

# ---- 数据库 / Redis（本地 infra/docker-compose.dev.yml）----
DATABASE_URL=postgresql+psycopg://z_image:z_image@localhost:5432/z_image
REDIS_URL=redis://localhost:6379/0

# ---- 模型目录（默认 <repo_root>/models）----
# MODELS_DIR=/absolute/path/to/Z-Image-app/models
MODELS_DIR=models

# ---- Z-Image 推理配置 ----
Z_IMAGE_VARIANT=turbo

# 可选：多 GPU 指定设备
# Z_IMAGE_DEVICE=cuda:0

# ---- DFloat11 模式（worker 使用）----
Z_IMAGE_DF11_ROOT=models/z-image-turbo-df11
Z_IMAGE_DF11_CPU_OFFLOAD=1
Z_IMAGE_TEXT_DF11_CPU_OFFLOAD=1

# ---- Celery worker 并发度 ----
# WORKER_CONCURRENCY=1

# （可选）PyTorch CUDA 内存分配策略（worker 常用）
PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True

# ---- API 鉴权（可选）----
# API_ENABLE_AUTH=true
# API_ADMIN_KEY=your-admin-key-here
# API_ALLOWED_KEYS=user-key-1,user-key-2

# ---- API 监听地址（scripts/dev_api.sh 使用）----
API_HOST=0.0.0.0
API_PORT=8000

# ---- 生成图片存储（Local / S3 / MinIO）----
# local：落到本地磁盘 outputs/z-image-outputs（legacy）
# Z_IMAGE_STORAGE_BACKEND=local
# Z_IMAGE_OUTPUT_DIR=outputs/z-image-outputs
#
# s3：写入 S3/MinIO（推荐，用于后续上云）
Z_IMAGE_STORAGE_BACKEND=s3

# ---- MinIO（S3 compatible）----
# docker compose 会用到这两个变量初始化 MinIO 账号
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# S3/MinIO 连接信息（api/worker 使用）
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET_NAME=z-image

# 可选：对象 Key 前缀（相当于“目录”），默认 z-image-outputs
S3_PREFIX=z-image-outputs
